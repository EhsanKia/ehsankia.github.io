(function(a){a.address=function(){var b=function(b){var c=a.extend(a.Event(b),function(){var b={},c=a.address.parameterNames();for(var d=0,e=c.length;d<e;d++){b[c[d]]=a.address.parameter(c[d])}return{value:a.address.value(),path:a.address.path(),pathNames:a.address.pathNames(),parameterNames:c,parameters:b,queryString:a.address.queryString()}}.call(a.address));a(a.address).trigger(c);return c},c=function(a){return Array.prototype.slice.call(a)},d=function(b,c,d){a().bind.apply(a(a.address),Array.prototype.slice.call(arguments));return a.address},e=function(b,c){a().unbind.apply(a(a.address),Array.prototype.slice.call(arguments));return a.address},f=function(){return R.pushState&&K.state!==z},g=function(){return("/"+S.pathname.replace(new RegExp(K.state),"")+S.search+(h()?"#"+h():"")).replace(V,"/")},h=function(){var a=S.href.indexOf("#");return a!=-1?m(S.href.substr(a+1),J):""},i=function(){return f()?g():h()},j=function(){try{return top.document!==z&&top.document.title!==z?top:window}catch(a){return window}},k=function(){return"javascript"},l=function(a){a=a.toString();return(K.strict&&a.substr(0,1)!="/"?"/":"")+a},m=function(a,b){if(K.crawlable&&b){return(a!==""?"!":"")+a}return a.replace(/^\!/,"")},n=function(a,b){return parseInt(a.css(b),10)},o=function(){if(!cb){var a=i(),b=decodeURI(hb)!=decodeURI(a);if(b){if(N&&M<7){S.reload()}else{if(N&&!X&&K.history){U(s,50)}_old=hb;hb=a;p(J)}}}},p=function(a){var c=b(F),d=b(a?G:H);U(r,10);if(c.isDefaultPrevented()||d.isDefaultPrevented()){q()}},q=function(){hb=_old;if(f()){R.popState({},"",K.state.replace(/\/$/,"")+(hb===""?"/":hb))}else{cb=I;if(O){if(K.history){S.hash="#"+m(hb,I)}else{S.replace("#"+m(hb,I))}}else if(hb!=i()){if(K.history){S.hash="#"+m(hb,I)}else{S.replace("#"+m(hb,I))}}if(N&&!X&&K.history){U(s,50)}if(O){U(function(){cb=J},1)}else{cb=J}}},r=function(){if(K.tracker!=="null"&&K.tracker!==A){var b=a.isFunction(K.tracker)?K.tracker:P[K.tracker],c=(S.pathname+S.search+(a.address&&!f()?a.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");if(a.isFunction(b)){b(c)}else if(a.isFunction(P.urchinTracker)){P.urchinTracker(c)}else if(P.pageTracker!==z&&a.isFunction(P.pageTracker._trackPageview)){P.pageTracker._trackPageview(c)}else if(P._gaq!==z&&a.isFunction(P._gaq.push)){P._gaq.push(["_trackPageview",decodeURI(c)])}}},s=function(){var a=k()+":"+J+";document.open();document.writeln('<html><head><title>"+Q.title.replace(/\'/g,"\\'")+"</title><script>var "+B+' = "'+encodeURIComponent(i()).replace(/\'/g,"\\'")+(Q.domain!=S.hostname?'";document.domain="'+Q.domain:"")+'";</'+"script></head></html>');document.close();";if(M<7){Y.src=a}else{Y.contentWindow.location.replace(a)}},t=function(){if(_&&ab!=-1){var a,b,c=_.substr(ab+1).split("&");for(a=0;a<c.length;a++){b=c[a].split("=");if(/^(autoUpdate|crawlable|history|strict|wrap)$/.test(b[0])){K[b[0]]=isNaN(b[1])?/^(true|yes)$/i.test(b[1]):parseInt(b[1],10)!==0}if(/^(state|tracker)$/.test(b[0])){K[b[0]]=b[1]}}_=A}_old=hb;hb=i()},u=function(){if(!db){db=I;t();var c=function(){v.call(this);y.call(this)},d=a("body").ajaxComplete(c);c();if(K.wrap){var e=a("body > *").wrapAll('<div style="padding:'+(n(d,"marginTop")+n(d,"paddingTop"))+"px "+(n(d,"marginRight")+n(d,"paddingRight"))+"px "+(n(d,"marginBottom")+n(d,"paddingBottom"))+"px "+(n(d,"marginLeft")+n(d,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+B+'" style="height:100%;overflow:auto;position:relative;'+(O&&!window.statusbar.visible?"resize:both;":"")+'" />');a("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"});if(O){a('<style type="text/css" />').appendTo("head").text("#"+B+"::-webkit-resizer { background-color: #fff; }")}}if(N&&!X){var g=Q.getElementsByTagName("frameset")[0];Y=Q.createElement((g?"":"i")+"frame");Y.src=k()+":"+J;if(g){g.insertAdjacentElement("beforeEnd",Y);g[g.cols?"cols":"rows"]+=",0";Y.noResize=I;Y.frameBorder=Y.frameSpacing=0}else{Y.style.display="none";Y.style.width=Y.style.height=0;Y.tabIndex=-1;Q.body.insertAdjacentElement("afterBegin",Y)}U(function(){a(Y).bind("load",function(){var a=Y.contentWindow;_old=hb;hb=a[B]!==z?a[B]:"";if(hb!=i()){p(J);S.hash=m(hb,I)}});if(Y.contentWindow[B]===z){s()}},50)}U(function(){b("init");p(J)},1);if(!f()){if(N&&M>7||!N&&X){if(P.addEventListener){P.addEventListener(D,o,J)}else if(P.attachEvent){P.attachEvent("on"+D,o)}}else{T(o,50)}}if("state"in window.history){a(window).trigger("popstate")}}},v=function(){var b,c=a("a"),d=c.size(),e=1,f=-1,g='[rel*="address:"]',h=function(){if(++f!=d){b=a(c.get(f));if(b.is(g)){b.address(g)}U(h,e)}};U(h,e)},w=function(){if(decodeURI(hb)!=decodeURI(i())){_old=hb;hb=i();p(J)}},x=function(){if(P.removeEventListener){P.removeEventListener(D,o,J)}else if(P.detachEvent){P.detachEvent("on"+D,o)}},y=function(){if(K.crawlable){var b=S.pathname.replace(/\/$/,""),c="_escaped_fragment_";if(a("body").html().indexOf(c)!=-1){a('a[href]:not([href^=http]), a[href*="'+document.domain+'"]').each(function(){var d=a(this).attr("href").replace(/^http:/,"").replace(new RegExp(b+"/?$"),"");if(d===""||d.indexOf(c)!=-1){a(this).attr("href","#"+encodeURI(decodeURIComponent(d.replace(new RegExp("/(.*)\\?"+c+"=(.*)$"),"!$2"))))}})}}},z,A=null,B="jQueryAddress",C="string",D="hashchange",E="init",F="change",G="internalChange",H="externalChange",I=true,J=false,K={autoUpdate:I,crawlable:J,history:I,strict:I,wrap:J},L=a.browser,M=parseFloat(L.version),N=!a.support.opacity,O=L.webkit||L.safari,P=j(),Q=P.document,R=P.history,S=P.location,T=setInterval,U=setTimeout,V=/\/{2,9}/g,W=navigator.userAgent,X="on"+D in P,Y,Z,_=a("script:last").attr("src"),ab=_?_.indexOf("?"):-1,bb=Q.title,cb=J,db=J,eb=I,fb=J,gb={},hb=i();_old=hb;if(N){M=parseFloat(W.substr(W.indexOf("MSIE")+4));if(Q.documentMode&&Q.documentMode!=M){M=Q.documentMode!=8?7:8}var ib=Q.onpropertychange;Q.onpropertychange=function(){if(ib){ib.call(Q)}if(Q.title!=bb&&Q.title.indexOf("#"+i())!=-1){Q.title=bb}}}if(R.navigationMode){R.navigationMode="compatible"}if(document.readyState=="complete"){var jb=setInterval(function(){if(a.address){u();clearInterval(jb)}},50)}else{t();a(u)}a(window).bind("popstate",w).bind("unload",x);return{bind:function(a,b,e){return d.apply(this,c(arguments))},unbind:function(a,b){return e.apply(this,c(arguments))},init:function(a,b){return d.apply(this,[E].concat(c(arguments)))},change:function(a,b){return d.apply(this,[F].concat(c(arguments)))},internalChange:function(a,b){return d.apply(this,[G].concat(c(arguments)))},externalChange:function(a,b){return d.apply(this,[H].concat(c(arguments)))},baseURL:function(){var a=S.href;if(a.indexOf("#")!=-1){a=a.substr(0,a.indexOf("#"))}if(/\/$/.test(a)){a=a.substr(0,a.length-1)}return a},autoUpdate:function(a){if(a!==z){K.autoUpdate=a;return this}return K.autoUpdate},crawlable:function(a){if(a!==z){K.crawlable=a;return this}return K.crawlable},history:function(a){if(a!==z){K.history=a;return this}return K.history},state:function(a){if(a!==z){K.state=a;var b=g();if(K.state!==z){if(R.pushState){if(b.substr(0,3)=="/#/"){S.replace(K.state.replace(/^\/$/,"")+b.substr(2))}}else if(b!="/"&&b.replace(/^\/#/,"")!=h()){U(function(){S.replace(K.state.replace(/^\/$/,"")+"/#"+b)},1)}}return this}return K.state},strict:function(a){if(a!==z){K.strict=a;return this}return K.strict},tracker:function(a){if(a!==z){K.tracker=a;return this}return K.tracker},wrap:function(a){if(a!==z){K.wrap=a;return this}return K.wrap},update:function(){fb=I;this.value(hb);fb=J;return this},title:function(a){if(a!==z){U(function(){bb=Q.title=a;if(eb&&Y&&Y.contentWindow&&Y.contentWindow.document){Y.contentWindow.document.title=a;eb=J}},50);return this}return Q.title},value:function(a){if(a!==z){a=l(a);if(a=="/"){a=""}if(hb==a&&!fb){return}_old=hb;hb=a;if(K.autoUpdate||fb){p(I);if(f()){R[K.history?"pushState":"replaceState"]({},"",K.state.replace(/\/$/,"")+(hb===""?"/":hb))}else{cb=I;if(O){if(K.history){S.hash="#"+m(hb,I)}else{S.replace("#"+m(hb,I))}}else if(hb!=i()){if(K.history){S.hash="#"+m(hb,I)}else{S.replace("#"+m(hb,I))}}if(N&&!X&&K.history){U(s,50)}if(O){U(function(){cb=J},1)}else{cb=J}}}return this}return l(hb)},path:function(a){if(a!==z){var b=this.queryString(),c=this.hash();this.value(a+(b?"?"+b:"")+(c?"#"+c:""));return this}return l(hb).split("#")[0].split("?")[0]},pathNames:function(){var a=this.path(),b=a.replace(V,"/").split("/");if(a.substr(0,1)=="/"||a.length===0){b.splice(0,1)}if(a.substr(a.length-1,1)=="/"){b.splice(b.length-1,1)}return b},queryString:function(a){if(a!==z){var b=this.hash();this.value(this.path()+(a?"?"+a:"")+(b?"#"+b:""));return this}var c=hb.split("?");return c.slice(1,c.length).join("?").split("#")[0]},parameter:function(b,c,d){var e,f;if(c!==z){var g=this.parameterNames();f=[];c=c===z||c===A?"":c.toString();for(e=0;e<g.length;e++){var h=g[e],i=this.parameter(h);if(typeof i==C){i=[i]}if(h==b){i=c===A||c===""?[]:d?i.concat([c]):[c]}for(var j=0;j<i.length;j++){f.push(h+"="+i[j])}}if(a.inArray(b,g)==-1&&c!==A&&c!==""){f.push(b+"="+c)}this.queryString(f.join("&"));return this}c=this.queryString();if(c){var k=[];f=c.split("&");for(e=0;e<f.length;e++){var l=f[e].split("=");if(l[0]==b){k.push(l.slice(1).join("="))}}if(k.length!==0){return k.length!=1?k:k[0]}}},parameterNames:function(){var b=this.queryString(),c=[];if(b&&b.indexOf("=")!=-1){var d=b.split("&");for(var e=0;e<d.length;e++){var f=d[e].split("=")[0];if(a.inArray(f,c)==-1){c.push(f)}}}return c},hash:function(a){if(a!==z){this.value(hb.split("#")[0]+(a?"#"+a:""));return this}var b=hb.split("#");return b.slice(1,b.length).join("#")}}}();a.fn.address=function(b){var c;if(typeof b=="string"){c=b;b=undefined}if(!a(this).attr("address")){var d=function(c){if(c.shiftKey||c.ctrlKey||c.metaKey||c.which==2){return true}if(a(this).is("a")){c.preventDefault();var d=b?b.call(this):/address:/.test(a(this).attr("rel"))?a(this).attr("rel").split("address:")[1].split(" ")[0]:a.address.state()!==undefined&&!/^\/?$/.test(a.address.state())?a(this).attr("href").replace(new RegExp("^(.*"+a.address.state()+"|\\.)"),""):a(this).attr("href").replace(/^(#\!?|\.)/,"");a.address.value(d)}};a(c?c:this).live("click",d).live("submit",function(c){if(a(this).is("form")){c.preventDefault();var d=a(this).attr("action"),e=b?b.call(this):(d.indexOf("?")!=-1?d.replace(/&$/,""):d+"?")+a(this).serialize();a.address.value(e)}}).attr("address",true)}return this}})(jQuery)